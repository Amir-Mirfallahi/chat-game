name: Deploy Website

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  # test:
  #   runs-on: ubuntu-latest
  #   if: github.event_name == 'pull_request'
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v4

  #     - name: Run tests
  #       run: |
  #         echo "ğŸ§ª Running tests..."
  #         # Add your test commands here
  #         # Example:
  #         # cd frontend && npm test
  #         # cd backend && python -m pytest
  #         echo "âœ… Tests passed"

  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to production
        uses: appleboy/ssh-action@v1
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          key: ${{ secrets.PRIVATE_KEY }}
          script: |
            set -e
            
            echo "ğŸš€ Starting deployment..."
            cd ${{ secrets.APPLICATION_DIRECTORY }}
            
            # Pull latest changes
            echo "ğŸ“¥ Pulling latest code..."
            git pull origin main
            
            # Build and restart services
            echo "ğŸ³ Building and restarting services..."
            docker compose up -d --build
            
            echo "ğŸ‰ Deployment completed successfully!"
